<aside class="sidebar flex flex-col h-full justify-between">
  <div>
    <ng-container *ngIf="location; else empty">
      <!-- –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–º–∏–∫–∞–Ω–Ω—è –º—ñ–∂ Location —Ç–∞ Pending -->
      <div *ngIf="pendingVersion" class="mb-3">
        <button
          (click)="toggleView()"
          class="px-3 py-1 rounded bg-blue-600 text-white hover:bg-blue-700 text-sm">
          {{ currentView === 'location' ? 'üîÅ –ü–æ–∫–∞–∑–∞—Ç–∏ –æ–Ω–æ–≤–ª–µ–Ω—É –≤–µ—Ä—Å—ñ—é' : '‚Ü© –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –¥–æ –æ—Ä–∏–≥—ñ–Ω–∞–ª—É' }}
        </button>
      </div>

      <p class="text-gray-600 mb-4">
        {{ getAccessibilityLevel(location.overallAccessibilityScore) }}
        <span *ngIf="location.overallAccessibilityScore != null" class="text-sm text-gray-400">
    ({{ location.overallAccessibilityScore }}%)
  </span>
      </p>
      <h2 class="text-xl font-bold mb-2 text-green-700">{{ displayData.name }}</h2>
      <p class="text-gray-600 mb-4">{{ displayData.address }}</p>

      <!-- –û–ø–∏—Å -->
      <div class="mb-4">
        <h3 class="font-semibold text-gray-800">–û–ø–∏—Å</h3>
        <p class="text-sm text-gray-700">{{ displayData.description || '–ù–µ–º–∞—î –æ–ø–∏—Å—É' }}</p>
      </div>

      <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—è -->
      <div class="mb-4">
        <h3 class="font-semibold text-gray-800">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</h3>
        <p class="text-sm text-gray-700">{{ location.type.name }}</p>
        <p class="text-sm text-gray-700">{{ location.type.description }}</p>
      </div>

      <!-- –ö–æ–Ω—Ç–∞–∫—Ç–∏ -->
      <div class="mb-4">
        <h3 class="font-semibold text-gray-800">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
        <ng-container
          *ngIf="displayData.contacts && (displayData.contacts.phone || displayData.contacts.email || displayData.contacts.website); else noContacts">
          <ul class="text-sm text-gray-700">
            <li *ngIf="displayData.contacts.phone">üìû {{ displayData.contacts.phone }}</li>
            <li *ngIf="displayData.contacts.email">‚úâÔ∏è {{ displayData.contacts.email }}</li>
            <li *ngIf="displayData.contacts.website">
              üåç <a [href]="displayData.contacts.website" target="_blank" class="text-blue-600 underline">
              {{ displayData.contacts.website }}
            </a>
            </li>
          </ul>
        </ng-container>
        <ng-template #noContacts>
          <p class="text-sm text-gray-500">–ù–µ–º–∞—î –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤</p>
        </ng-template>
      </div>

      <!-- –†–æ–∑–∫–ª–∞–¥ -->
      <div class="mb-4">
        <h3 class="font-semibold text-gray-800">–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏</h3>
        <ng-container *ngIf="displayData?.workingHours && !hasNoSchedule(displayData.workingHours); else noSchedule">
          <div *ngFor="let d of days">
            <div>{{ d.label }}: {{ getDaySchedule(d.key, displayData.workingHours) }}</div>
          </div>
        </ng-container>
        <ng-template #noSchedule>
          <p class="text-sm text-gray-500">–ù–µ–º–∞—î —Ä–æ–∑–∫–ª–∞–¥—É</p>
        </ng-template>
      </div>

      <!-- –°—Ç–∞—Ç—É—Å -->
      <div class="mb-4">
        <h3 class="font-semibold text-gray-800">–°—Ç–∞–Ω</h3>
        <ng-container [ngSwitch]="location.status">
          <p *ngSwitchCase="'published'" class="text-sm font-medium text-green-600">–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ</p>
          <p *ngSwitchCase="'pending'" class="text-sm font-medium text-yellow-600">–û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏</p>
          <p *ngSwitchCase="'rejected'" class="text-sm font-medium text-red-600">–í—ñ–¥—Ö–∏–ª–µ–Ω–æ</p>
          <p *ngSwitchDefault class="text-sm font-medium text-gray-500">–ù–µ–≤—ñ–¥–æ–º–∏–π —Å—Ç–∞—Ç—É—Å</p>
        </ng-container>
      </div>

      <!-- –ö—Ä–∏—Ç–µ—Ä—ñ—ó -->
      <div *ngIf="criteriaTree" class="mb-4">
        <div class="ml-1">
          <!-- –ì—Ä—É–ø–∞ -->
          <div class="cursor-pointer select-none font-semibold text-gray-800 flex items-center"
               (click)="toggleGroup()">
            <span [class.rotate-90]="showGroup" class="mr-1 transition-transform duration-200">‚ñ∂</span>
            {{ criteriaTree.group.name }}
          </div>

          <!-- –¢–∏–ø–∏ -->
          <div *ngIf="showGroup" class="ml-4 mt-2 transition-all duration-200">
            <div *ngFor="let type of criteriaTree.group.types" class="mb-2">
              <div class="cursor-pointer select-none flex items-center text-gray-700"
                   (click)="toggleType(type)">
                <span [class.rotate-90]="isTypeOpen(type)" class="mr-1 transition-transform duration-200">‚ñ∂</span>
                <strong>{{ type.name }}</strong>
              </div>

              <!-- –ö—Ä–∏—Ç–µ—Ä—ñ—ó -->
              <ul *ngIf="isTypeOpen(type)" class="ml-6 list-disc text-sm text-gray-700 mt-1 space-y-1">
                <li *ngFor="let c of type.criterias">
                  <div class="font-medium text-gray-800">
                    {{ c.name }}
                    <small class="text-gray-500">({{ c.rank }})</small>
                  </div>
                  <div class="text-gray-600 text-xs mb-1">{{ c.description }}</div>

                  <!-- –ù–æ–≤–∏–π –±–ª–æ–∫ –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ -->
                  <div *ngIf="c.barrierlessCriteriaChecks?.length > 0; else noChecks"
                       class="ml-4 text-xs text-gray-700 mt-2">
                    <!-- –ë–∞–ª–∞–Ω—Å –¥—É–º–æ–∫ -->
                    <div class="mt-2">
                      <div class="flex justify-between text-xs mb-1">
                        <span class="text-green-700 font-medium">–ë–µ–∑–±–∞—Ä‚Äô—î—Ä–Ω–æ: {{ countChecks(c, false) }}</span>
                        <span class="text-red-700 font-medium">–ü—Ä–æ–±–ª–µ–º–∏: {{ countChecks(c, true) }}</span>
                      </div>

                      <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –ø–æ–≤–∑—É–Ω–∫–∞ -->
                      <div
                        class="relative w-full h-3 rounded-full bg-gradient-to-r from-green-500 via-yellow-300 to-red-500">
                        <!-- –ü–æ–≤–∑—É–Ω–æ–∫ -->
                        <div
                          class="absolute top-1/2 -translate-y-1/2 w-2 h-4 bg-gray-800 rounded-full shadow-md transition-all duration-300"
                          [style.left.%]="getBalancePosition(c)">
                        </div>
                      </div>

                      <div class="text-xs text-gray-500 mt-1 text-center">
                        {{ 100 - getBalancePosition(c) | number:'1.0-0' }}% –±–µ–∑–±–∞—Ä‚Äô—î—Ä–Ω–æ /
                        {{ getBalancePosition(c) | number:'1.0-0' }}% –∑ –ø—Ä–æ–±–ª–µ–º–∞–º–∏
                      </div>
                    </div>


                    <!-- –ö–Ω–æ–ø–∫–∞ –¥–ª—è —Ä–æ–∑–∫—Ä–∏—Ç—Ç—è –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ -->
                    <div class="cursor-pointer text-blue-600 hover:underline select-none"
                         (click)="toggleComments(c)">
                      üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ ({{ getComments(c).length }})
                    </div>

                    <!-- –°–ø–∏—Å–æ–∫ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ -->
                    <ul *ngIf="isCommentsOpen(c)" class="ml-4 mt-1 list-disc text-gray-600 text-xs space-y-1">
                      <li *ngFor="let comment of getComments(c)">
                        "{{ comment }}"
                      </li>
                    </ul>
                  </div>

                  <ng-template #noChecks>
                    <p class="text-gray-400 text-xs italic ml-2">
                      –ù–µ–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫
                    </p>
                  </ng-template>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- –ü–æ—Ä–æ–∂–Ω—ñ–π —Å—Ç–∞–Ω -->
    <ng-template #empty>
      <div class="flex flex-col items-center justify-center h-full text-center">
        <h1 class="font-semibold text-2xl mb-3">–í–∏–±–µ—Ä—ñ—Ç—å –ª–æ–∫–∞—Ü—ñ—é<br>–Ω–∞ –∫–∞—Ä—Ç—ñ</h1>
        <img ngSrc="assets/hand-point.png" alt="hand point" height="128" width="128">
      </div>
    </ng-template>
  </div>

  <!-- –ù–∏–∂–Ω—ñ–π –±–ª–æ–∫ (–¥—É–±–ª—ñ–∫–∞—Ç) -->
  <div *ngIf="duplicateMode && location" class="mt-4 border-t pt-3">
    <p class="font-medium text-gray-700 mb-2">–¶–µ –≤–∞—à–∞ –ª–æ–∫–∞—Ü—ñ—è? (–ø–µ—Ä–µ–π—Ç–∏ –¥–æ —Ä–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è)</p>
    <div class="flex gap-3">
      <button (click)="confirmYes()" class="px-4 py-2 rounded bg-green-600 text-white hover:bg-green-700">–¢–∞–∫</button>
      <button (click)="confirmNo()" class="px-4 py-2 rounded bg-gray-200 hover:bg-gray-300">–ù—ñ</button>
    </div>
  </div>

  <!-- –ù–∏–∂–Ω—ñ–π –±–ª–æ–∫ —ñ–∑ –ø–æ—Å–∏–ª–∞–Ω–Ω—è–º–∏ -->
  <div *ngIf="location" class="mt-6 border-t pt-4 text-sm text-gray-700 space-y-2">
    <p *ngIf="location.status === 'published'">
      –î–∞–π—Ç–µ –æ—Ü—ñ–Ω–∫—É –ª–æ–∫–∞—Ü—ñ—ó –∑–≥—ñ–¥–Ω–æ –∫—Ä–∏—Ç–µ—Ä—ñ—è–º –±–µ–∑–±–∞—Ä'—î—Ä–Ω–æ—Å—Ç—ñ:
      <a [routerLink]="['/evaluate', location.id]" class="text-blue-600 underline hover:text-blue-800">
        –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –æ—Ü—ñ–Ω–∫–∏ –ª–æ–∫–∞—Ü—ñ—ó
      </a>
    </p>

    <p *ngIf="location.status !== 'published'" class="text-gray-500 italic">
      –û—Ü—ñ–Ω—é–≤–∞–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ –¥–ª—è –Ω–µ–æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–∏—Ö –ª–æ–∫–∞—Ü—ñ–π.
    </p>


    <p *ngIf="!duplicateMode && location.status === 'published'">
      –•–æ—á–µ—Ç–µ –æ–Ω–æ–≤–∏—Ç–∏ –¥–∞–Ω—ñ –ª–æ–∫–∞—Ü—ñ—ó?
      <a href="#" (click)="openPendingCopyForm($event)" class="text-blue-600 underline hover:text-blue-800">
        –ü–µ—Ä–µ–π—Ç–∏ –¥–æ –≤–Ω–µ—Å–µ–Ω–Ω—è –Ω–æ–≤–∏—Ö –¥–∞–Ω–∏—Ö
      </a>
    </p>

    <p *ngIf="!duplicateMode && location.status !== 'published'" class="text-gray-500 italic">
      –†–µ–¥–∞–≥—É–≤–∞–Ω–Ω—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–µ, –ø–æ–∫–∏ –ª–æ–∫–∞—Ü—ñ—è –Ω–µ –æ–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–∞.
    </p>


    <app-location-pending-copy-form
      *ngIf="showPendingCopyForm"
      [locationId]="location.id"
      [prefillData]="displayData"
      (close)="showPendingCopyForm = false"
      (saved)="onPendingCopySaved($event)">
    </app-location-pending-copy-form>

  </div>
</aside>
