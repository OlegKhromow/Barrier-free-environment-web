<div class="text-center my-4">
  <h2 class="text-2xl font-semibold py-2 w-full bg-white rounded-xl shadow-lg text-deep-dark-blue tracking-wide">
    {{ location?.name }}
  </h2>
  <p class="mt-3 text-gray-500 italic text-sm tracking-wide">
    üìç {{ location?.address }}
  </p>

  <p class="my-4 text-lg font-bold" [ngClass]="getAccessibilityColor(location?.overallAccessibilityScore)">
    {{ getAccessibilityLevel(location?.overallAccessibilityScore) }}
    @if (location?.overallAccessibilityScore) {
      <span class="text-sm text-gray-400">({{ location?.overallAccessibilityScore }}%)</span>
    }
  </p>
</div>

<!--Description-->
<div class="mb-6 p-4 bg-white rounded-xl shadow-sm">
  <h3 class="text-lg font-semibold text-deep-dark-blue mb-2 flex items-center gap-2">üìù –û–ø–∏—Å</h3>
  <p class="text-sm text-gray-700 leading-relaxed">{{ location?.description || '–ù–µ–º–∞—î –æ–ø–∏—Å—É' }}</p>
</div>

<div class="mb-6 p-4 bg-white rounded-xl shadow-sm">
  <h3 class="text-lg font-semibold text-deep-dark-blue mb-2 flex items-center gap-2">üè∑ –ö–∞—Ç–µ–≥–æ—Ä—ñ—è</h3>
  <p class="text-base font-medium text-gray-800">{{ location?.type?.name }}</p>
  <p class="text-sm text-gray-600 italic mt-1">{{ location?.type?.description }}</p>
</div>


<!-- –ö–æ–Ω—Ç–∞–∫—Ç–∏ -->
<div class="mb-6 p-4 bg-white rounded-xl shadow-sm">
  <h3 class="text-lg font-semibold text-deep-dark-blue mb-3 flex items-center gap-2">üìû –ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>

  @if (location?.contacts && (location?.contacts?.phone || location?.contacts?.email || location?.contacts?.website)) {
    <ul class="space-y-2 text-sm text-gray-800">

      @if (location?.contacts?.phone) {
        <li class="flex items-center gap-2">
          <span class="text-blue-600 text-lg">üì±</span>
          <a href="tel:{{location?.contacts?.phone}}"
             class="underline hover:text-blue-700">{{ location?.contacts?.phone }}</a>
        </li>
      }

      @if (location?.contacts?.email) {
        <li class="flex items-center gap-2">
          <span class="text-blue-600 text-lg">‚úâÔ∏è</span>
          <a href="mailto:{{location?.contacts?.email}}"
             class="underline hover:text-blue-700">{{ location?.contacts?.email }}</a>
        </li>
      }

      @if (location?.contacts?.website) {
        <li class="flex items-center gap-2">
          <span class="text-blue-600 text-lg">üåê</span>
          <a
            [href]="location?.contacts?.website?.startsWith('http') ? location?.contacts?.website : 'https://' + location?.contacts?.website"
            target="_blank"
            class="text-blue-600 underline hover:text-blue-700">{{ location?.contacts?.website }}</a>
        </li>
      }

    </ul>
  } @else {
    <p class="text-sm text-gray-500 italic">–ù–µ–º–∞—î –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤</p>
  }
</div>


<!-- –†–æ–∑–∫–ª–∞–¥ -->
<div class="mb-6 p-4 bg-white rounded-xl shadow-sm border border-gray-200">
  <h3 class="text-lg font-semibold text-deep-dark-blue mb-3 flex items-center gap-2">üïí –ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏</h3>

  @if (location?.workingHours && !hasNoSchedule(location?.workingHours)) {

    <table class="w-full border-collapse text-sm">
      <tbody>
        @for (g of getGroupedSchedule(location?.workingHours); track g.schedule) {
          <tr class="border-b last:border-0 border-gray-200">
            <td class="py-2 pr-4 font-medium text-gray-800 w-1/3">{{ formatDaysGroup(g.days) }}</td>
            <td class="py-2 text-gray-600">{{ g.schedule }}</td>
          </tr>
        }
      </tbody>
    </table>

  } @else {
    <p class="text-sm text-gray-500 italic">–ù–µ–º–∞—î —Ä–æ–∑–∫–ª–∞–¥—É</p>
  }
</div>


<!-- –°—Ç–∞—Ç—É—Å -->
<div class="mb-6 p-4 bg-white rounded-xl shadow-sm">
  <h3 class="text-lg font-semibold text-deep-dark-blue mb-2 flex items-center gap-2">üìå –°—Ç–∞—Ç—É—Å</h3>

  @switch (location?.status) {
    @case ('published') {
      <p class="text-sm font-semibold text-green-600 bg-green-50 px-3 py-1 rounded-full w-fit">–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ</p>
    }
    @case ('pending') {
      <p class="text-sm font-semibold text-yellow-600 bg-yellow-50 px-3 py-1 rounded-full w-fit">–û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏</p>
    }
    @case ('rejected') {
      <p class="text-sm font-semibold text-red-600 bg-red-50 px-3 py-1 rounded-full w-fit">–í—ñ–¥—Ö–∏–ª–µ–Ω–æ</p>
    }
    @default {
      <p class="text-sm font-medium text-gray-500">–ù–µ–≤—ñ–¥–æ–º–∏–π —Å—Ç–∞—Ç—É—Å</p>
    }
  }
</div>


<!-- –ö—Ä–∏—Ç–µ—Ä—ñ—ó -->
<div class="mt-2 p-4 transition-all duration-200 bg-white rounded-xl shadow-sm">
  @for (type of criteriaTree.group.types; track type) {
    @if (type.criterias.length !== 0) {
      <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∏–ø—É –∫—Ä–∏—Ç–µ—Ä—ñ—é -->
      <div class="mb-2">
        <div class="cursor-pointer select-none flex items-center text-gray-700"
             (click)="toggleType(type)">
        <span class="mr-1 transition-transform duration-200"
              [class.rotate-90]="isTypeOpen(type)">‚ñ∂</span>
          <strong>{{ type.name }}</strong>
        </div>

        <!-- –ö—Ä–∏—Ç–µ—Ä—ñ—ó -->
        @if (isTypeOpen(type)) {
          <div class="overflow-hidden ml-6" animate.enter="enter-animation" animate.leave="leave-animation">
            <ul class="ml-6 list-disc text-lg text-gray-700 mt-1 space-y-2">
              @for (c of type.criterias; track c) {

                <li>
                  <!-- –ù–∞–∑–≤–∞ –∫—Ä–∏—Ç–µ—Ä—ñ—é -->
                  <div class="font-medium text-gray-800">
                    {{ c.name }}
                    <small class="text-gray-500">({{ c.rank }})</small>
                  </div>

                  <!-- –û–ø–∏—Å -->
                  <div class="text-gray-600 text-xs mb-1">
                    {{ c.description }}
                  </div>

                  <!-- –Ø–∫—â–æ —î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ -->
                  @if (c.barrierlessCriteriaChecks?.length > 0) {

                    <!-- –õ—ñ—á–∏–ª—å–Ω–∏–∫–∏ -->
                    <div class="ml-4 text-xs text-gray-700 mt-2">
                      <div class="flex justify-between text-xs mb-1">
                    <span class="text-green-700 font-medium">
                      –ë–µ–∑–±–∞—Ä‚Äô—î—Ä–Ω–æ: {{ countChecks(c, false) }}
                    </span>
                        <span class="text-red-700 font-medium">
                      –ü—Ä–æ–±–ª–µ–º–∏: {{ countChecks(c, true) }}
                    </span>
                      </div>

                      <!-- –ü–æ–≤–∑—É–Ω–æ–∫ -->
                      <div class="relative w-full h-3 rounded-full bg-gradient-to-r
                              from-green-500 via-yellow-300 to-red-500">
                        <div class="absolute top-1/2 -translate-y-1/2
                                w-2 h-4 bg-gray-800 rounded-full shadow-md
                                transition-all duration-300"
                             [style.left.%]="getBalancePosition(c) !== 100 ? getBalancePosition(c) : null"
                             [style.right.%]="getBalancePosition(c) === 100 ? 0 : null">
                        </div>
                      </div>

                      <div class="text-xs text-gray-500 mt-1 text-center">
                        {{ 100 - getBalancePosition(c) | number:'1.0-0' }}% –±–µ–∑–±–∞—Ä‚Äô—î—Ä–Ω–æ /
                        {{ getBalancePosition(c) | number:'1.0-0' }}% –∑ –ø—Ä–æ–±–ª–µ–º–∞–º–∏
                      </div>

                      <!-- Comments -->
                      <div class="cursor-pointer text-blue-600 hover:underline select-none mt-2 flex items-center gap-1"
                           (click)="toggleComments(c)">
                        üí¨ <span>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ ({{ preparedComments.get(c)?.length || 0 }})</span>
                      </div>

                      @if (isCommentsOpen(c)) {
                        <ul class="ml-4 mt-3 space-y-3">
                          @for (comment of preparedComments.get(c); track comment) {
                            @if (comment.comment != undefined || commentImages.has(comment.imageServiceId)) {
                              <li
                                class="border-l-4 border-deep-dark-blue pl-3 py-1 bg-gray-50 shadow-sm rounded-sm">
                                <p class="text-sm font-medium text-gray-900 mb-2 italic">
                                  {{ comment.comment }}
                                </p>
                                <app-slideshow-component
                                  [images]="commentImages.get(comment.imageServiceId) ?? null"
                                  [compactMode]="true"></app-slideshow-component>
                              </li>
                            }
                          }
                        </ul>
                      }
                    </div>

                  } @else {
                    <p class="text-gray-400 text-xs italic ml-2">
                      –ù–µ–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫
                    </p>
                  }
                </li>
              }
            </ul>
          </div>
        }
      </div>
    }
  }
</div>

