<div class="container mx-auto p-6 max-w-6xl">
  <ng-container *ngIf="location; else empty">
    <!-- –î–≤—ñ –∫–æ–ª–æ–Ω–∫–∏: —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è + –∫–∞—Ä—Ç–∞ -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

      <!-- –õ–Ü–í–ê –ö–û–õ–û–ù–ö–ê ‚Äî –Ü–ù–§–û–†–ú–ê–¶–Ü–Ø -->
      <div>
        <p class="text-gray-600 mb-4">
          {{ getAccessibilityLevel(location.overallAccessibilityScore) }}
          <span *ngIf="location.overallAccessibilityScore != null" class="text-sm text-gray-400">
            ({{ location.overallAccessibilityScore }}%)
          </span>
        </p>

        <div class="flex items-center justify-between mb-2">
          <h1 class="text-3xl font-bold text-green-700">{{ location.name }}</h1>
          <button
            (click)="openUpdateForm($event)"
            class="text-sm text-blue-600 hover:text-blue-800 bg-blue-50 hover:bg-blue-100 px-3 py-1 rounded-lg transition"
          >
            –†–µ–¥–∞–≥—É–≤–∞—Ç–∏
          </button>
        </div>


        <app-location-edit-dialog
          *ngIf="showUpdateForm"
          [locationId]="location.id"
          [prefillData]="location"
          (close)="showUpdateForm = false"
          (saved)="onUpdateSubmitted($event)">
        </app-location-edit-dialog>
        <p class="text-gray-600 mb-6">{{ location.address }}</p>

        <!-- –û–ø–∏—Å -->
        <section class="mb-6">
          <h2 class="font-semibold text-gray-800 text-lg mb-1">–û–ø–∏—Å</h2>
          <p class="text-sm text-gray-700">{{ location.description || '–ù–µ–º–∞—î –æ–ø–∏—Å—É' }}</p>
        </section>

        <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—è -->
        <section class="mb-6">
          <h2 class="font-semibold text-gray-800 text-lg mb-1">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</h2>
          <p class="text-sm text-gray-700">{{ location.type.name }}</p>
          <p class="text-sm text-gray-700">{{ location.type.description }}</p>
        </section>

        <!-- –ö–æ–Ω—Ç–∞–∫—Ç–∏ -->
        <section class="mb-6">
          <h2 class="font-semibold text-gray-800 text-lg mb-1">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h2>
          <ng-container
            *ngIf="location.contacts && (location.contacts.phone || location.contacts.email || location.contacts.website); else noContacts">
            <ul class="text-sm text-gray-700 space-y-1">
              <li *ngIf="location.contacts.phone">üìû {{ location.contacts.phone }}</li>
              <li *ngIf="location.contacts.email">‚úâÔ∏è {{ location.contacts.email }}</li>
              <li *ngIf="location.contacts.website">
                üåç <a [href]="location.contacts.website" target="_blank"
                     class="text-blue-600 underline">{{ location.contacts.website }}</a>
              </li>
            </ul>
          </ng-container>
          <ng-template #noContacts>
            <p class="text-sm text-gray-500">–ù–µ–º–∞—î –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤</p>
          </ng-template>
        </section>

        <!-- –†–æ–∑–∫–ª–∞–¥ -->
        <section class="mb-6">
          <h2 class="font-semibold text-gray-800 text-lg mb-1">–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏</h2>
          <ng-container *ngIf="location?.workingHours && !hasNoSchedule(location.workingHours); else noSchedule">
            <div *ngFor="let d of days" class="text-sm text-gray-700">
              {{ d.label }}: {{ getDaySchedule(d.key, location.workingHours) }}
            </div>
          </ng-container>
          <ng-template #noSchedule>
            <p class="text-sm text-gray-500">–ù–µ–º–∞—î —Ä–æ–∑–∫–ª–∞–¥—É</p>
          </ng-template>
        </section>

        <!-- –°—Ç–∞—Ç—É—Å -->
        <section class="mb-6">
          <h2 class="font-semibold text-gray-800 text-lg mb-1">–°—Ç–∞–Ω</h2>
          <ng-container [ngSwitch]="location.status">
            <p *ngSwitchCase="'published'" class="text-sm font-medium text-green-600">–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ</p>
            <p *ngSwitchCase="'pending'" class="text-sm font-medium text-yellow-600">–û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏</p>
            <p *ngSwitchCase="'rejected'" class="text-sm font-medium text-red-600">–í—ñ–¥—Ö–∏–ª–µ–Ω–æ</p>
            <p *ngSwitchDefault class="text-sm font-medium text-gray-500">–ù–µ–≤—ñ–¥–æ–º–∏–π —Å—Ç–∞—Ç—É—Å</p>
          </ng-container>
        </section>
      </div>
      <!-- –ö–Ω–æ–ø–∫–∏ –∫–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å–æ–º -->
      <section class="mb-6">
        <h2 class="font-semibold text-gray-800 text-lg mb-2">–ö–µ—Ä—É–≤–∞–Ω–Ω—è —Å—Ç–∞—Ç—É—Å–æ–º</h2>

        <!-- pending -->
        <div *ngIf="location.status === 'pending'" class="space-x-2">
          <button
            (click)="changeStatus('published')"
            class="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded-lg">
            –û–ø—É–±–ª—ñ–∫—É–≤–∞—Ç–∏
          </button>

          <button
            (click)="openRejectForm()"
            class="bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-lg">
            –í—ñ–¥—Ö–∏–ª–∏—Ç–∏
          </button>

          <button
            (click)="deleteLocation()"
            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded-lg">
            –í–∏–¥–∞–ª–∏—Ç–∏
          </button>
        </div>

        <!-- published -->
        <div *ngIf="location.status === 'published'" class="space-x-2">
          <button
            (click)="changeStatus('pending')"
            class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-lg">
            –ó–Ω—è—Ç–∏ –∑ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—ó
          </button>

          <button
            (click)="deleteLocation()"
            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded-lg">
            –í–∏–¥–∞–ª–∏—Ç–∏
          </button>
        </div>

        <!-- rejected -->
        <div *ngIf="location.status === 'rejected'" class="space-x-2">
          <button
            (click)="changeStatus('pending')"
            class="bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded-lg">
            –í—ñ–¥–ø—Ä–∞–≤–∏—Ç–∏ –Ω–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫—É
          </button>

          <button
            (click)="deleteLocation()"
            class="bg-gray-200 hover:bg-gray-300 text-gray-800 px-3 py-1 rounded-lg">
            –í–∏–¥–∞–ª–∏—Ç–∏
          </button>
        </div>
      </section>

      <!-- ü™ü –§–æ—Ä–º–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è -->
      <div *ngIf="showRejectForm" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
        <div class="bg-white rounded-lg p-6 w-full max-w-md shadow-lg">
          <h2 class="text-xl font-semibold mb-4 text-gray-800">–ü—Ä–∏—á–∏–Ω–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è</h2>
          <textarea [(ngModel)]="rejectionReason"
                    rows="4"
                    class="w-full border rounded-lg p-2 text-sm focus:ring focus:ring-red-200"
                    placeholder="–û–ø–∏—à—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è"></textarea>

          <div class="text-right mt-4 space-x-2">
            <button (click)="cancelRejection()" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
              –°–∫–∞—Å—É–≤–∞—Ç–∏
            </button>
            <button (click)="submitRejection()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
              –í—ñ–¥—Ö–∏–ª–∏—Ç–∏
            </button>
          </div>
        </div>
      </div>



      <!-- –ü–†–ê–í–ê –ö–û–õ–û–ù–ö–ê ‚Äî –ö–ê–†–¢–ê -->
      <div class="relative">
        <div id="map" class="w-full h-[400px] rounded-xl shadow-md border"></div>
      </div>
    </div>

    <!-- –ö—Ä–∏—Ç–µ—Ä—ñ—ó –Ω–∏–∂—á–µ –ø—ñ–¥ –∫–∞—Ä—Ç–æ—é -->
    <section *ngIf="criteriaTree" class="mt-10 border-t pt-6">
      <div class="ml-1">
        <div class="cursor-pointer font-semibold text-gray-800 flex items-center" (click)="toggleGroup()">
          <span [class.rotate-90]="showGroup" class="mr-1 transition-transform duration-200">‚ñ∂</span>
          {{ criteriaTree.group.name }}
        </div>

        <div *ngIf="showGroup" class="ml-4 mt-2 transition-all duration-200">
          <div *ngFor="let type of criteriaTree.group.types" class="mb-3">
            <div class="cursor-pointer flex items-center text-gray-700" (click)="toggleType(type)">
              <span [class.rotate-90]="isTypeOpen(type)" class="mr-1 transition-transform duration-200">‚ñ∂</span>
              <strong>{{ type.name }}</strong>
            </div>

            <ul *ngIf="isTypeOpen(type)" class="ml-6 list-disc text-sm text-gray-700 mt-1 space-y-2">
              <li *ngFor="let c of type.criterias">
                <div class="font-medium text-gray-800">
                  {{ c.name }} <small class="text-gray-500">({{ c.rank }})</small>
                </div>
                <div class="text-gray-600 text-xs mb-1">{{ c.description }}</div>

                <div *ngIf="c.barrierlessCriteriaChecks?.length > 0; else noChecks"
                     class="ml-4 text-xs text-gray-700 mt-2">
                  <div class="flex justify-between text-xs mb-1">
                    <span class="text-green-700 font-medium">–ë–µ–∑–±–∞—Ä‚Äô—î—Ä–Ω–æ: {{ countChecks(c, false) }}</span>
                    <span class="text-red-700 font-medium">–ü—Ä–æ–±–ª–µ–º–∏: {{ countChecks(c, true) }}</span>
                  </div>

                  <div
                    class="relative w-full h-3 rounded-full bg-gradient-to-r from-green-500 via-yellow-300 to-red-500">
                    <div
                      class="absolute top-1/2 -translate-y-1/2 w-2 h-4 bg-gray-800 rounded-full shadow-md transition-all duration-300"
                      [style.left.%]="getBalancePosition(c)">
                    </div>
                  </div>

                  <div class="text-xs text-gray-500 mt-1 text-center">
                    {{ 100 - getBalancePosition(c) | number:'1.0-0' }}% –±–µ–∑–±–∞—Ä‚Äô—î—Ä–Ω–æ /
                    {{ getBalancePosition(c) | number:'1.0-0' }}% –∑ –ø—Ä–æ–±–ª–µ–º–∞–º–∏
                  </div>

                  <div class="cursor-pointer text-blue-600 hover:underline mt-1"
                       (click)="toggleComments(c)">
                    üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ ({{ getComments(c).length }})
                  </div>

                  <ul *ngIf="isCommentsOpen(c)" class="ml-4 mt-1 list-disc text-gray-600 text-xs space-y-1">
                    <li *ngFor="let comment of getComments(c)">"{{ comment }}"</li>
                  </ul>
                </div>

                <ng-template #noChecks>
                  <p class="text-gray-400 text-xs italic ml-2">–ù–µ–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫</p>
                </ng-template>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>
  </ng-container>

  <ng-template #empty>
    <div class="flex flex-col items-center justify-center h-96 text-center">
      <h1 class="font-semibold text-2xl mb-3">–õ–æ–∫–∞—Ü—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞</h1>
      <img ngSrc="assets/hand-point.png" alt="hand point" height="128" width="128">
    </div>
  </ng-template>
  <!-- üÜï –°–ï–ö–¶–Ü–Ø –û–ù–û–í–õ–ï–ù–ù–Ø -->
  <section class="mt-10 border-t pt-6">
    <h2 class="text-xl font-semibold text-gray-800 mb-3">–û–Ω–æ–≤–ª–µ–Ω–Ω—è</h2>

    <ng-container *ngIf="pendingLocations.length > 0; else noUpdates">
      <ul class="space-y-3">
        <li
          *ngFor="let pending of pendingLocations"
          class="border rounded-lg p-4 bg-gray-50 cursor-pointer hover:bg-gray-100 transition"
          (click)="openModal(pending)"
        >
          <div class="flex justify-between items-center">
            <div>
              <p class="font-medium text-gray-800">{{ pending.name || '–ë–µ–∑ –Ω–∞–∑–≤–∏' }}</p>
              <p class="text-sm text-gray-600">{{ pending.address }}</p>
            </div>
            <span *ngIf="pending.status === 'pending'"  class="text-xs text-yellow-700 bg-yellow-100 px-2 py-1 rounded">
      –û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏
    </span>
            <span *ngIf="pending.status === 'rejected'"  class="text-xs text-white bg-red-700 px-2 py-1 rounded">
      –í—ñ–¥–º–æ–≤–ª–µ–Ω–æ
    </span>
          </div>
          <div *ngIf="pending.description" class="text-sm text-gray-700 mt-2">
            {{ pending.description }}
          </div>
          <div class="text-xs text-gray-500 mt-1">
            –û–Ω–æ–≤–ª–µ–Ω–æ: {{ pending.updatedAt | date:'medium' }}
          </div>
        </li>

      </ul>
    </ng-container>

    <ng-template #noUpdates>
      <p class="text-sm text-gray-500">–ù–∞—Ä–∞–∑—ñ –Ω–µ–º–∞—î –æ–Ω–æ–≤–ª–µ–Ω—å.</p>
    </ng-template>
  </section>


  <!-- –°–ø–∏—Å–æ–∫ —Å—Ö–æ–∂–∏—Ö -->
  <div *ngIf="showDuplicates && similarLocations.length" class="mt-6">
    <h3 class="text-lg font-semibold mb-2">–°—Ö–æ–∂—ñ –ª–æ–∫–∞—Ü—ñ—ó –ø–æ—Ä—É—á:</h3>

    <ul class="divide-y divide-gray-200 border rounded-lg">
      <li *ngFor="let loc of similarLocations" class="p-3 hover:bg-gray-50 flex justify-between items-center">
        <div>
          <div class="font-medium text-gray-800">{{ loc.name }}</div>
          <div class="text-sm text-gray-500">{{ loc.address }}</div>
        </div>
        <button class="text-blue-600 hover:underline"
                (click)="viewLocation(loc.id)">
          –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏
        </button>
        <button class="text-red-600 hover:underline"
                (click)="openDuplicateModal(loc)">
          –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω—ñ
        </button>


      </li>
    </ul>
  </div>
  <!-- ü™ü –ú–û–î–ê–õ–ö–ê –î–õ–Ø REJECTED –ü–ï–ù–î–Ü–ù–ì–£ -->
  <div *ngIf="showRejectedPendingModal"
       class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white w-full max-w-md rounded-xl shadow-lg p-6 relative">

      <button (click)="showRejectedPendingModal = false"
              class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-xl">‚úï</button>

      <h2 class="text-2xl font-semibold mb-4 text-center text-red-700">–í—ñ–¥—Ö–∏–ª–µ–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</h2>

      <div class="space-y-2 text-sm text-gray-800">
        <p><strong>–ù–∞–∑–≤–∞:</strong> {{ selectedPending?.name }}</p>
        <p><strong>–ê–¥—Ä–µ—Å–∞:</strong> {{ selectedPending?.address }}</p>
        <p><strong>–û–ø–∏—Å:</strong> {{ selectedPending?.description || '‚Äî' }}</p>

        <div *ngIf="selectedPending?.contacts">
          <p><strong>–¢–µ–ª–µ—Ñ–æ–Ω:</strong> {{ selectedPending?.contacts.phone || '‚Äî' }}</p>
          <p><strong>Email:</strong> {{ selectedPending?.contacts.email || '‚Äî' }}</p>
          <p><strong>–°–∞–π—Ç:</strong> {{ selectedPending?.contacts.website || '‚Äî' }}</p>
        </div>
        <section class="mb-6">
          <h2 class="font-semibold text-gray-800 text-lg mb-1">–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏</h2>

          <ng-container *ngIf="selectedPending?.workingHours && !hasNoSchedule(selectedPending.workingHours); else noSchedulePending">
            <div *ngFor="let d of days" class="text-sm text-gray-700">
              {{ d.label }}: {{ getDaySchedule(d.key, selectedPending.workingHours) }}
            </div>
          </ng-container>

          <ng-template #noSchedulePending>
            <p class="text-sm text-gray-500">–ù–µ–º–∞—î —Ä–æ–∑–∫–ª–∞–¥—É</p>
          </ng-template>
        </section>


        <p *ngIf="selectedPending?.rejectionReason" class="text-red-600 mt-3">
          <strong>–ü—Ä–∏—á–∏–Ω–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è:</strong> {{ selectedPending.rejectionReason }}
        </p>
      </div>

      <div class="flex justify-end mt-6 space-x-2">
        <button (click)="showRejectedPendingModal = false"
                class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
          –ó–∞–∫—Ä–∏—Ç–∏
        </button>

        <button (click)="deletePending(selectedPending.id)"
                class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
          –í–∏–¥–∞–ª–∏—Ç–∏
        </button>
      </div>
    </div>
  </div>

  <!-- ü™ü –ú–æ–¥–∞–ª–∫–∞ –ø–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è -->
  <div
    *ngIf="showModal && selectedPending && modalLocation"
    class="fixed inset-0 bg-black bg-opacity-40 flex items-start justify-center z-50 pt-10 overflow-y-auto"
  >
    <div class="bg-white w-[95%] max-w-6xl rounded-xl shadow-lg p-6 relative">
      <button
        (click)="closeModal()"
        class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-xl"
      >
        ‚úï
      </button>

      <h2 class="text-2xl font-semibold mb-6 text-center">–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –¥–∞–Ω–∏—Ö –ª–æ–∫–∞—Ü—ñ—ó</h2>

      <div class="divide-y">
        <!-- –ù–∞–∑–≤–∞ -->
        <div class="grid grid-cols-2 gap-6 py-3 items-start">
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ù–∞–∑–≤–∞</h3>
            <div class="flex justify-between text-sm">
              <span>{{ modalLocation?.name }}</span>
              <button (click)="swapField('name')" class="ml-2 text-blue-600">‚ÆÇ</button>
            </div>
          </div>
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ù–∞–∑–≤–∞</h3>
            <div class="text-sm flex justify-between">
              <span>{{ selectedPending?.name }}</span>
            </div>
          </div>
        </div>

        <!-- –ê–¥—Ä–µ—Å–∞ -->
        <div class="grid grid-cols-2 gap-6 py-3 items-start">
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ê–¥—Ä–µ—Å–∞</h3>
            <div class="flex justify-between text-sm">
              <span>{{ modalLocation?.address }}</span>
              <button (click)="swapField('address')" class="ml-2 text-blue-600">‚ÆÇ</button>
            </div>
          </div>
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ê–¥—Ä–µ—Å–∞</h3>
            <div class="text-sm flex justify-between">
              <span>{{ selectedPending?.address }}</span>
            </div>
          </div>
        </div>

        <!-- –û–ø–∏—Å -->
        <div class="grid grid-cols-2 gap-6 py-3 items-start">
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–û–ø–∏—Å</h3>
            <div class="flex justify-between text-sm">
              <p class="whitespace-pre-line max-h-48 overflow-auto">{{ modalLocation?.description }}</p>
              <button (click)="swapField('description')" class="ml-2 text-blue-600 flex-shrink-0">‚ÆÇ</button>
            </div>
          </div>
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–û–ø–∏—Å</h3>
            <div class="text-sm max-h-48 overflow-auto">
              {{ selectedPending?.description }}
            </div>
          </div>
        </div>

        <!-- –ö–æ–Ω—Ç–∞–∫—Ç–∏ -->
        <div class="grid grid-cols-2 gap-6 py-3 items-start">
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
            <div *ngFor="let field of ['phone','email','website']" class="flex justify-between text-sm">
              <span>{{ field }}: {{ modalLocation?.contacts?.[field] || '‚Äî' }}</span>
              <button (click)="swapContactField(field)" class="ml-2 text-blue-600">‚ÆÇ</button>
            </div>
          </div>
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
            <div class="text-sm space-y-1">
              <div *ngFor="let field of ['phone','email','website']">
                {{ field }}: {{ selectedPending?.contacts?.[field] || '‚Äî' }}
              </div>
            </div>
          </div>
        </div>

        <!-- –†–æ–∑–∫–ª–∞–¥ -->
        <div class="grid grid-cols-2 gap-6 py-3 items-start">
          <div>
            <div class="flex justify-between items-center">
              <h3 class="font-semibold text-gray-700 mb-1">–†–æ–∑–∫–ª–∞–¥ —Ä–æ–±–æ—Ç–∏</h3>
              <button (click)="swapWorkingHours()" class="text-blue-600 text-sm ml-2">‚ÆÇ</button>
            </div>
            <div class="border rounded p-2 text-xs">
              <div *ngFor="let d of days" class="border-b last:border-0 py-1">
                <strong>{{ d.label }}:</strong>
                {{ modalLocation?.workingHours?.[d.key]?.open || '‚Äî' }} ‚Äì
                {{ modalLocation?.workingHours?.[d.key]?.close || '‚Äî' }}
              </div>
            </div>
          </div>

          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–†–æ–∑–∫–ª–∞–¥ —Ä–æ–±–æ—Ç–∏</h3>
            <div class="border rounded p-2 text-xs">
              <div *ngFor="let d of days" class="border-b last:border-0 py-1">
                <strong>{{ d.label }}:</strong>
                {{ selectedPending?.workingHours?.[d.key]?.open || '‚Äî' }} ‚Äì
                {{ selectedPending?.workingHours?.[d.key]?.close || '‚Äî' }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="flex justify-end gap-2 mt-4">
        <button class="btn btn-primary" (click)="confirmChanges()">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
        <button class="btn btn-outline" (click)="closeModal()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        <button class="btn btn-danger" (click)="openRejectPendingForm()">–í—ñ–¥—Ö–∏–ª–∏—Ç–∏</button>
      </div>
      <div *ngIf="showRejectPendingForm" class="mt-4 p-3 border rounded bg-gray-50">
        <label for="reason" class="block font-medium mb-1">–ü—Ä–∏—á–∏–Ω–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è</label>
        <textarea id="reason" [(ngModel)]="rejectionPendingReason"
                  class="w-full border p-2 rounded"
                  rows="3" placeholder="–í–∫–∞–∂—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É..."></textarea>

        <div class="flex justify-end gap-2 mt-2">
          <button class="btn btn-secondary" (click)="cancelPendingRejection()">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
          <button class="btn btn-danger" (click)="submitPendingRejection()">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è</button>
        </div>
      </div>


    </div>
  </div>
  <!-- ü™ü –§–æ—Ä–º–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è -->
  <div *ngIf="showRejectForm" class="fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center z-50">
    <div class="bg-white rounded-lg p-6 w-full max-w-md shadow-lg">
      <h2 class="text-xl font-semibold mb-4 text-gray-800">–ü—Ä–∏—á–∏–Ω–∞ –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è</h2>
      <textarea [(ngModel)]="rejectionReason"
                rows="4"
                class="w-full border rounded-lg p-2 text-sm focus:ring focus:ring-red-200"
                placeholder="–û–ø–∏—à—ñ—Ç—å –ø—Ä–∏—á–∏–Ω—É –≤—ñ–¥—Ö–∏–ª–µ–Ω–Ω—è"></textarea>

      <div class="text-right mt-4 space-x-2">
        <button (click)="cancelRejection()" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">
          –°–∫–∞—Å—É–≤–∞—Ç–∏
        </button>
        <button (click)="submitRejection()" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
          –í—ñ–¥—Ö–∏–ª–∏—Ç–∏
        </button>
      </div>
    </div>
  </div>

  <div
    *ngIf="showModalDuplicate && selectedDuplicate && modalLocation"
    class="fixed inset-0 bg-black bg-opacity-40 flex items-start justify-center z-50 pt-10 overflow-y-auto"
  >
    <div class="bg-white w-[95%] max-w-6xl rounded-xl shadow-lg p-6 relative">
      <button
        (click)="closeModalDuplicate()"
        class="absolute top-3 right-3 text-gray-500 hover:text-gray-800 text-xl"
      >
        ‚úï
      </button>

      <h2 class="text-2xl font-semibold mb-6 text-center">–ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –¥–∞–Ω–∏—Ö –ª–æ–∫–∞—Ü—ñ—ó</h2>

      <div class="divide-y">
        <!-- –ù–∞–∑–≤–∞ -->
        <div class="grid grid-cols-2 gap-6 py-3 items-start">
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ù–∞–∑–≤–∞</h3>
            <div class="flex justify-between text-sm">
              <span>{{ selectedDuplicate?.name }}</span>
              <button (click)="swapDuplicateField('name')" class="ml-2 text-blue-600">‚ÆÇ</button>
            </div>
          </div>
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ù–∞–∑–≤–∞</h3>
            <div class="text-sm flex justify-between">
              <span>{{ modalLocation?.name }}</span>
            </div>
          </div>
        </div>

        <!-- –ê–¥—Ä–µ—Å–∞ -->
        <div class="grid grid-cols-2 gap-6 py-3 items-start">
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ê–¥—Ä–µ—Å–∞</h3>
            <div class="flex justify-between text-sm">
              <span>{{ selectedDuplicate?.address }}</span>
              <button (click)="swapDuplicateField('address')" class="ml-2 text-blue-600">‚ÆÇ</button>
            </div>
          </div>
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ê–¥—Ä–µ—Å–∞</h3>
            <div class="text-sm flex justify-between">
              <span>{{ modalLocation?.address }}</span>
            </div>
          </div>
        </div>

        <!-- –û–ø–∏—Å -->
        <div class="grid grid-cols-2 gap-6 py-3 items-start">
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–û–ø–∏—Å</h3>
            <div class="flex justify-between text-sm">
              <p class="whitespace-pre-line max-h-48 overflow-auto">{{ selectedDuplicate?.description }}</p>
              <button (click)="swapDuplicateField('description')" class="ml-2 text-blue-600 flex-shrink-0">‚ÆÇ</button>
            </div>
          </div>
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–û–ø–∏—Å</h3>
            <div class="text-sm max-h-48 overflow-auto">
              {{ modalLocation?.description }}
            </div>
          </div>
        </div>

        <!-- –ö–æ–Ω—Ç–∞–∫—Ç–∏ -->
        <div class="grid grid-cols-2 gap-6 py-3 items-start">
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
            <div *ngFor="let field of ['phone','email','website']" class="flex justify-between text-sm">
              <span>{{ field }}: {{ selectedDuplicate?.contacts?.[field] || '‚Äî' }}</span>
              <button (click)="swapDuplicateContactField(field)" class="ml-2 text-blue-600">‚ÆÇ</button>
            </div>
          </div>
          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h3>
            <div class="text-sm space-y-1">
              <div *ngFor="let field of ['phone','email','website']">
                {{ field }}: {{ modalLocation?.contacts?.[field] || '‚Äî' }}
              </div>
            </div>
          </div>
        </div>

        <!-- –†–æ–∑–∫–ª–∞–¥ -->
        <div class="grid grid-cols-2 gap-6 py-3 items-start">
          <div>
            <div class="flex justify-between items-center">
              <h3 class="font-semibold text-gray-700 mb-1">–†–æ–∑–∫–ª–∞–¥ —Ä–æ–±–æ—Ç–∏</h3>
              <button (click)="swapDuplicateWorkingHours()" class="text-blue-600 text-sm ml-2">‚ÆÇ</button>
            </div>
            <div class="border rounded p-2 text-xs">
              <div *ngFor="let d of days" class="border-b last:border-0 py-1">
                <strong>{{ d.label }}:</strong>
                {{ selectedDuplicate?.workingHours?.[d.key]?.open || '‚Äî' }} ‚Äì
                {{ selectedDuplicate?.workingHours?.[d.key]?.close || '‚Äî' }}
              </div>
            </div>
          </div>

          <div>
            <h3 class="font-semibold text-gray-700 mb-1">–†–æ–∑–∫–ª–∞–¥ —Ä–æ–±–æ—Ç–∏</h3>
            <div class="border rounded p-2 text-xs">
              <div *ngFor="let d of days" class="border-b last:border-0 py-1">
                <strong>{{ d.label }}:</strong>
                {{ modalLocation?.workingHours?.[d.key]?.open || '‚Äî' }} ‚Äì
                {{ modalLocation?.workingHours?.[d.key]?.close || '‚Äî' }}
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="mt-6 text-right space-x-2">
        <button
          (click)="closeModalDuplicate()"
          class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300"
        >
          –ó–∞–∫—Ä–∏—Ç–∏
        </button>

        <button
          (click)="confirmDuplicateChanges()"
          class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700"
        >
          ‚úÖ –ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏ –∑–º—ñ–Ω–∏
        </button>
      </div>

    </div>
  </div>



</div>
