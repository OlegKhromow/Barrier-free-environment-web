<div class="container mx-auto p-6 max-w-4xl">
  <ng-container *ngIf="location; else empty">

    <p class="text-gray-600 mb-4">
      {{ getAccessibilityLevel(location.overallAccessibilityScore) }}
      <span *ngIf="location.overallAccessibilityScore != null" class="text-sm text-gray-400">
        ({{ location.overallAccessibilityScore }}%)
      </span>
    </p>

    <h1 class="text-3xl font-bold mb-2 text-green-700">{{ location.name }}</h1>
    <p class="text-gray-600 mb-6">{{ location.address }}</p>

    <!-- –û–ø–∏—Å -->
    <section class="mb-6">
      <h2 class="font-semibold text-gray-800 text-lg mb-1">–û–ø–∏—Å</h2>
      <p class="text-sm text-gray-700">{{ location.description || '–ù–µ–º–∞—î –æ–ø–∏—Å—É' }}</p>
    </section>

    <!-- –ö–∞—Ç–µ–≥–æ—Ä—ñ—è -->
    <section class="mb-6">
      <h2 class="font-semibold text-gray-800 text-lg mb-1">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è</h2>
      <p class="text-sm text-gray-700">{{ location.type?.name }}</p>
      <p class="text-sm text-gray-700">{{ location.type?.description }}</p>
    </section>

    <!-- –ö–æ–Ω—Ç–∞–∫—Ç–∏ -->
    <section class="mb-6">
      <h2 class="font-semibold text-gray-800 text-lg mb-1">–ö–æ–Ω—Ç–∞–∫—Ç–∏</h2>
      <ng-container *ngIf="location.contacts && (location.contacts.phone || location.contacts.email || location.contacts.website); else noContacts">
        <ul class="text-sm text-gray-700 space-y-1">
          <li *ngIf="location.contacts.phone">üìû {{ location.contacts.phone }}</li>
          <li *ngIf="location.contacts.email">‚úâÔ∏è {{ location.contacts.email }}</li>
          <li *ngIf="location.contacts.website">
            üåç <a [href]="location.contacts.website" target="_blank" class="text-blue-600 underline">{{ location.contacts.website }}</a>
          </li>
        </ul>
      </ng-container>
      <ng-template #noContacts>
        <p class="text-sm text-gray-500">–ù–µ–º–∞—î –∫–æ–Ω—Ç–∞–∫—Ç—ñ–≤</p>
      </ng-template>
    </section>

    <!-- –†–æ–∑–∫–ª–∞–¥ -->
    <section class="mb-6">
      <h2 class="font-semibold text-gray-800 text-lg mb-1">–ì—Ä–∞—Ñ—ñ–∫ —Ä–æ–±–æ—Ç–∏</h2>
      <ng-container *ngIf="location?.workingHours && !hasNoSchedule(location.workingHours); else noSchedule">
        <div *ngFor="let d of days" class="text-sm text-gray-700">
          {{ d.label }}: {{ getDaySchedule(d.key, location.workingHours) }}
        </div>
      </ng-container>
      <ng-template #noSchedule>
        <p class="text-sm text-gray-500">–ù–µ–º–∞—î —Ä–æ–∑–∫–ª–∞–¥—É</p>
      </ng-template>
    </section>

    <!-- –°—Ç–∞—Ç—É—Å -->
    <section class="mb-6">
      <h2 class="font-semibold text-gray-800 text-lg mb-1">–°—Ç–∞–Ω</h2>
      <ng-container [ngSwitch]="location.status">
        <p *ngSwitchCase="'published'" class="text-sm font-medium text-green-600">–û–ø—É–±–ª—ñ–∫–æ–≤–∞–Ω–æ</p>
        <p *ngSwitchCase="'pending'" class="text-sm font-medium text-yellow-600">–û—á—ñ–∫—É—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏</p>
        <p *ngSwitchCase="'rejected'" class="text-sm font-medium text-red-600">–í—ñ–¥—Ö–∏–ª–µ–Ω–æ</p>
        <p *ngSwitchDefault class="text-sm font-medium text-gray-500">–ù–µ–≤—ñ–¥–æ–º–∏–π —Å—Ç–∞—Ç—É—Å</p>
      </ng-container>
    </section>

    <!-- –ö—Ä–∏—Ç–µ—Ä—ñ—ó -->
    <section *ngIf="criteriaTree" class="mb-8 border-t pt-4">
      <div class="ml-1">
        <div class="cursor-pointer font-semibold text-gray-800 flex items-center" (click)="toggleGroup()">
          <span [class.rotate-90]="showGroup" class="mr-1 transition-transform duration-200">‚ñ∂</span>
          {{ criteriaTree.group.name }}
        </div>

        <div *ngIf="showGroup" class="ml-4 mt-2 transition-all duration-200">
          <div *ngFor="let type of criteriaTree.group.types" class="mb-3">
            <div class="cursor-pointer flex items-center text-gray-700" (click)="toggleType(type)">
              <span [class.rotate-90]="isTypeOpen(type)" class="mr-1 transition-transform duration-200">‚ñ∂</span>
              <strong>{{ type.name }}</strong>
            </div>

            <ul *ngIf="isTypeOpen(type)" class="ml-6 list-disc text-sm text-gray-700 mt-1 space-y-2">
              <li *ngFor="let c of type.criterias">
                <div class="font-medium text-gray-800">
                  {{ c.name }} <small class="text-gray-500">({{ c.rank }})</small>
                </div>
                <div class="text-gray-600 text-xs mb-1">{{ c.description }}</div>

                <!-- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∏ -->
                <div *ngIf="c.barrierlessCriteriaChecks?.length > 0; else noChecks" class="ml-4 text-xs text-gray-700 mt-2">
                  <div class="flex justify-between text-xs mb-1">
                    <span class="text-green-700 font-medium">–ë–µ–∑–±–∞—Ä‚Äô—î—Ä–Ω–æ: {{ countChecks(c, false) }}</span>
                    <span class="text-red-700 font-medium">–ü—Ä–æ–±–ª–µ–º–∏: {{ countChecks(c, true) }}</span>
                  </div>

                  <div class="relative w-full h-3 rounded-full bg-gradient-to-r from-green-500 via-yellow-300 to-red-500">
                    <div class="absolute top-1/2 -translate-y-1/2 w-2 h-4 bg-gray-800 rounded-full shadow-md transition-all duration-300"
                         [style.left.%]="getBalancePosition(c)">
                    </div>
                  </div>

                  <div class="text-xs text-gray-500 mt-1 text-center">
                    {{ 100 - getBalancePosition(c) | number:'1.0-0' }}% –±–µ–∑–±–∞—Ä‚Äô—î—Ä–Ω–æ /
                    {{ getBalancePosition(c) | number:'1.0-0' }}% –∑ –ø—Ä–æ–±–ª–µ–º–∞–º–∏
                  </div>

                  <!-- –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ -->
                  <div class="cursor-pointer text-blue-600 hover:underline mt-1"
                       (click)="toggleComments(c)">
                    üí¨ –ö–æ–º–µ–Ω—Ç–∞—Ä—ñ ({{ getComments(c).length }})
                  </div>

                  <ul *ngIf="isCommentsOpen(c)" class="ml-4 mt-1 list-disc text-gray-600 text-xs space-y-1">
                    <li *ngFor="let comment of getComments(c)">"{{ comment }}"</li>
                  </ul>
                </div>

                <ng-template #noChecks>
                  <p class="text-gray-400 text-xs italic ml-2">–ù–µ–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫</p>
                </ng-template>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </section>

  </ng-container>

  <ng-template #empty>
    <div class="flex flex-col items-center justify-center h-96 text-center">
      <h1 class="font-semibold text-2xl mb-3">–õ–æ–∫–∞—Ü—ñ—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–∞</h1>
      <img ngSrc="assets/hand-point.png" alt="hand point" height="128" width="128">
    </div>
  </ng-template>
</div>
